package com.chinadaily.adapter

import android.content.Intent
import android.graphics.Color
import android.graphics.drawable.GradientDrawable
import android.support.v7.widget.RecyclerView
import android.view.LayoutInflater
import android.view.ViewGroup
import com.alibaba.fastjson.JSON
import com.bumptech.glide.Priority
import com.chinadaily.R
import com.chinadaily.activity.NewsDetailActivity
import com.chinadaily.data.NewsBean
import com.chinadaily.http.HttpConstants
import com.chinadaily.utils.DeviceUtils
import com.chinadaily.utils.GlideApp
import kotlinx.android.synthetic.main.adapter_view_pager.view.*


class HeaderPagerAdapter : RecyclerView.Adapter<HeaderPagerHolder>() {
    private var data = mutableListOf<NewsBean>()
    fun refreshData(data: List<NewsBean>) {
        this.data.clear()
        this.data.addAll(data)
        notifyDataSetChanged()
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): HeaderPagerHolder {
        return HeaderPagerHolder(parent)
    }

    override fun getItemCount(): Int {
        return data.size
    }

    override fun onBindViewHolder(holder: HeaderPagerHolder, position: Int) {
        holder.refreshData(data[position])
    }
}

class HeaderPagerHolder(parent: ViewGroup) : RecyclerView.ViewHolder(LayoutInflater.from(parent.context).inflate(R.layout.adapter_view_pager, parent, false)) {
    private lateinit var data: NewsBean
    fun refreshData(data: NewsBean) {
        this.data = data
        itemView.pagerTitle.typeface = TF1
        itemView.pagerTitle.text = data.title
        itemView.pagerTitle.background = background
        val imgUrl = HttpConstants.SERVICE_URL + data.bigTitleImage
        GlideApp.with(itemView.pagerImg)
                .load(imgUrl)
                .priority(Priority.HIGH)
                .placeholder(R.drawable.news_big_default)
                .error(R.drawable.news_big_default)
                .centerCrop()
                .into(itemView.pagerImg)
    }

    private val background by lazy { GradientDrawable(GradientDrawable.Orientation.TOP_BOTTOM, intArrayOf(Color.TRANSPARENT, Color.parseColor("#cc000000"))) }

    init {
        val width = DeviceUtils.width()
        val height = width * 9 / 16
        itemView.layoutParams = ViewGroup.LayoutParams(width, height)
        itemView.setOnClickListener {
            it.context.startActivity(Intent(it.context, NewsDetailActivity::class.java).apply {
                putExtra("bean", JSON.toJSONString(this@HeaderPagerHolder.data))
            })
        }
    }
}